<mat-drawer-container autosize>
  <mat-drawer
    #startDrawer
    id="startDrawer"
    class="mat-elevation-z5"
    mode="side"
    position="start"
    opened="false"
  >
    <h2 class="mat-h2">
      Search
      <button
        mat-icon-button
        #closeStartDrawerFab
        id="closeStartDrawerFab"
        (click)="startDrawer.close()"
      >
        <mat-icon>navigate_before</mat-icon>
      </button>
    </h2>
    <mat-form-field #searchFormField id="searchFormField">
      <input matInput placeholder="Search Spots" />
    </mat-form-field>
    <div id="searchSpotList">
      <app-spot-card
        *ngFor="let spot of searchSpots"
        [spot]="spot"
        [clickable]="true"
        [preview]="true"
        (click)="selectedSpot = spot; startDrawer.close()"
      ></app-spot-card>
    </div>
  </mat-drawer>

  <mat-drawer
    #endDrawer
    id="endDrawer"
    class="mat-elevation-z5"
    mode="side"
    position="end"
    [opened]="selectedSpot && !editingBounds"
  >
    <div *ngIf="selectedSpot">
      <app-spot-card
        [spot]="selectedSpot"
        [flat]="true"
        [dismissable]="true"
        (dismiss)="closeSpot()"
        (edit)="editSpot()"
      ></app-spot-card>
    </div>
  </mat-drawer>

  <agm-map
    #map
    id="map"
    [latitude]="start_coordinates.lat"
    [longitude]="start_coordinates.lng"
    [zoom]="this.zoom"
    [backgroundColor]="'#000a12'"
    [clickableIcons]="false"
    [disableDefaultUI]="true"
    [zoomControl]="false"
    [streetViewControl]="true"
    [fitBounds]="false"
    gestureHandling="'greedy'"
    [mapTypeId]="mapStyle"
    [styles]="mapStylesConfig"
    (mapClick)="clickedMap($event)"
    (boundsChange)="boundsChanged($event)"
    (centerChange)="centerChanged($event)"
    (zoomChange)="zoomChanged($event)"
  >
    <agm-circle
      *ngFor="let dot of visibleDots"
      [fillColor]="'#304ffe'"
      [latitude]="dot.location.latitude"
      [longitude]="dot.location.longitude"
      [circleDraggable]="false"
      [circleDraggable]="false"
      [strokeWeight]="0"
      [strokeOpacity]="0"
      [radius]="getDotRadius(zoom, dot.location)"
      [visible]="true"
      [fillOpacity]="1"
    ></agm-circle>

    <agm-polygon
      *ngFor="let spot of visibleSpots"
      [paths]="spot.paths"
      [fillColor]="'#304ffe'"
      [strokeColor]="'#304ffe'"
      [fillOpacity]="0.15"
      [editable]="editingBounds"
      (polyClick)="clickedSpot(spot)"
      (polyPathsChange)="pathsChanged($event)"
    >
    </agm-polygon>
    <agm-marker
      *ngIf="selectedSpot"
      [agmFitBounds]="true"
      [latitude]="selectedSpot.data.location.latitude"
      [longitude]="selectedSpot.data.location.longitude"
      [title]="'Test'"
      iconUrl="/assets/icons/marker.png"
      [markerDraggable]="false"
      [markerClickable]="false"
    ></agm-marker>

    <agm-marker
      *ngIf="droppedMarkerLocation"
      #droppedMarker
      id="droppedMarker"
      [latitude]="droppedMarkerLocation.lat"
      [longitude]="droppedMarkerLocation.lng"
      iconUrl="/assets/icons/marker.png"
      [markerDraggable]="true"
      [markerClickable]="true"
    ></agm-marker>
  </agm-map>

  <button mat-fab #searchFab id="searchFab" (click)="startDrawer.open()">
    <mat-icon aria-label="Button with magnifying lens to search for spots"
      >search</mat-icon
    >
  </button>

  <button
    mat-mini-fab
    #mapStyleFab
    color="white"
    id="mapStyleFab"
    (click)="toggleMapStyle()"
  >
    <mat-icon aria-label="Button with magnifying lens to search for spots">
      {{ mapStyle === "roadmap" ? "terrain" : "map" }}
    </mat-icon>
  </button>

  <button
    *ngIf="!editingBounds"
    mat-fab
    #createSpotFab
    id="createSpotFab"
    (click)="createSpot()"
  >
    <mat-icon aria-label="Button with plus to create a new spot"
      >add_location</mat-icon
    >
  </button>

  <button
    color="white"
    *ngIf="editingBounds"
    mat-mini-fab
    #exitBoundsEditFab
    id="exitBoundsEditFab"
    (click)="stopEditingSpot()"
  >
    <mat-icon aria-label="Button with cross to spot editing">
      close
    </mat-icon>
  </button>
  <button
    *ngIf="editingBounds"
    mat-fab
    #saveBoundsEditFab
    id="saveBoundsEditFab"
    (click)="saveBoundsEdit()"
  >
    <mat-icon
      aria-label="Button with check mark to stop editing the bounds of the spot"
    >
      check
    </mat-icon>
  </button>
</mat-drawer-container>
